name: Test Data Generation Script

on:
  workflow_dispatch:
    inputs:
      force_regenerate:
        description: 'Force regenerate all data files (for testing)'
        required: false
        default: false
        type: boolean

jobs:
  test_data_generation:
    runs-on: ubuntu-latest
    name: Test Data Generation Script
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Generate JSON data files
        run: |
          echo "ğŸš€ Starting manual data generation..."
          echo "Force regenerate: ${{ github.event.inputs.force_regenerate }}"
          
          # Try main data generation
          if npm run generate-data; then
            echo "âœ… Data generation successful"
          else
            echo "âŒ Data generation failed, using fallback"
            npm run generate-fallback
          fi

      - name: Show generated files
        run: |
          echo "ğŸ“ Generated data structure:"
          find data/ -type f -exec ls -la {} \;
          echo ""
          echo "ğŸ“Š File contents summary:"
          find data/ -name "*.json" -exec echo "=== {} ===" \; -exec head -10 {} \;

      - name: Test data generation results
        run: |
          echo "ğŸ“Š Data generation test completed"
          echo "ğŸš« Generated files are not committed (excluded by .gitignore)"
          echo "â„¹ï¸ This workflow is for testing the data generation script only"
          echo "ğŸš€ Actual deployment happens automatically via Azure Static Web Apps"

      - name: Summary
        run: |
          echo "ğŸ‰ Manual data generation test completed!"
          echo "âœ… Data generation script is working correctly"
          echo "ğŸ“ Note: Files are generated but not committed to repository"
          echo "ğŸŒ Live updates happen automatically through Azure Static Web Apps deployment"
