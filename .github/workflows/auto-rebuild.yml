name: Auto Rebuild Site Data

on:
  # Disable this workflow since data generation is now handled by Azure Static Web Apps workflow
  # schedule:
  #   - cron: '0 5,11,17,23 * * *'
  
  # Allow manual triggering for testing
  workflow_dispatch:

# Note: This workflow is now primarily for testing the data generation script
# The Azure Static Web Apps workflow handles automatic data generation and deployment

jobs:
  test-data-generation:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
        
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        if [ -f package.json ]; then
          npm install
        fi
        
    - name: Test data generation
      run: |
        echo "🧪 Testing data generation script..."
        node scripts/generate-data.js
        
    - name: Verify generated files
      run: |
        echo "📁 Checking generated data structure..."
        if [ -d "data" ]; then
          echo "✅ Data directory created"
          find data/ -type f -name "*.json" | head -10
          echo "📊 Total JSON files: $(find data/ -name "*.json" | wc -l)"
        else
          echo "❌ Data directory not found"
          exit 1
        fi
        
    - name: Summary
      run: |
        echo "✅ Data generation test completed successfully"
        echo "ℹ️ Note: Generated files are not committed (excluded by .gitignore)"
        echo "🚀 Actual deployment happens via Azure Static Web Apps workflow"
